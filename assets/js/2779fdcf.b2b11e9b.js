"use strict";(self.webpackChunk_0_l_documentation=self.webpackChunk_0_l_documentation||[]).push([[5551],{6975:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>d,contentTitle:()=>n,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>l});var r=o(5893),a=o(1151);const i={sidebar_position:8,sidebar_label:"Hot Upgrades",description:"Upgrading Framework Libraries"},n="Network Hot Upgrades",s={id:"validators/hot-upgrades",title:"Network Hot Upgrades",description:"Upgrading Framework Libraries",source:"@site/docs/validators/hot-upgrades.md",sourceDirName:"validators",slug:"/validators/hot-upgrades",permalink:"/validators/hot-upgrades",draft:!1,unlisted:!1,editUrl:"https://github.com/0LNetworkCommunity/documentation/edit/main/docs/validators/hot-upgrades.md",tags:[],version:"current",sidebarPosition:8,frontMatter:{sidebar_position:8,sidebar_label:"Hot Upgrades",description:"Upgrading Framework Libraries"},sidebar:"tutorialSidebar",previous:{title:"VFN",permalink:"/validators/vfn-setup"},next:{title:"YAML Templates",permalink:"/category/yaml-templates"}},d={},l=[{value:"Overview",id:"overview",level:2},{value:"Procedure",id:"procedure",level:2},{value:"Build Artifacts",id:"build-artifacts",level:3},{value:"1. Build the upgrade Move transaction scripts",id:"1-build-the-upgrade-move-transaction-scripts",level:5},{value:"2. Share the output artifacts on Github.",id:"2-share-the-output-artifacts-on-github",level:5},{value:"Upgrade Ceremony",id:"upgrade-ceremony",level:3},{value:"3. With <code>txs</code> anyone (no authority needed) can submit the proposal and metadata. You&#39;ll need to provide the actual script compiled path, and an optional URL which contains documentation of the proposal (e.g github).",id:"3-with-txs-anyone-no-authority-needed-can-submit-the-proposal-and-metadata-youll-need-to-provide-the-actual-script-compiled-path-and-an-optional-url-which-contains-documentation-of-the-proposal-eg-github",level:5},{value:"4. With <code>libra txs</code> anyone with governance authority (the epoch&#39;s validators as of <code>V7</code>), can submit a vote in favor (or against it with <code>--should-fail</code>).",id:"4-with-libra-txs-anyone-with-governance-authority-the-epochs-validators-as-of-v7-can-submit-a-vote-in-favor-or-against-it-with---should-fail",level:5},{value:"6. Use <code>txs</code> to resolve a successfully approved proposal",id:"6-use-txs-to-resolve-a-successfully-approved-proposal",level:5}];function c(e){const t={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h5:"h5",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.h1,{id:"network-hot-upgrades",children:"Network Hot Upgrades"}),"\n",(0,r.jsx)(t.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(t.p,{children:'The "framework" which contains all the consensus, account, econ policies, etc. for the network is written in Move. This code is stored in the network database, and effectively executed on demand. This means that framework upgrades can occur without redeploying the Move VM itself, or the supporting system code (network node software). It also means the state machine can upgrade without a coordinated halt.'}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["To do this we require two libra tools: ",(0,r.jsx)(t.code,{children:"framework"})," for building the artifacts, and ",(0,r.jsx)(t.code,{children:"txs"})," for proposing, voting, and ultimately deploying the artifacts."]}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"procedure",children:"Procedure"}),"\n",(0,r.jsx)(t.h3,{id:"build-artifacts",children:"Build Artifacts"}),"\n",(0,r.jsx)(t.h5,{id:"1-build-the-upgrade-move-transaction-scripts",children:"1. Build the upgrade Move transaction scripts"}),"\n",(0,r.jsx)(t.p,{children:"This will be a Move package which is machine-generated for a one-time execution. It contains bytecode which will be allowed to be executed (by anyone), once there is a vote and agreement on the proposal passing. The on-chain execution is guarded with a hash of this transaction, which the proposer provides in the proposal transaction (in advance of the vote)."}),"\n",(0,r.jsx)(t.p,{children:"An upgrade script that is tampered with will yield a different execution hash, and will be prevented from running (it is likely to be blocked by the transaction size limits before entering the mempool)."}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"framework upgrade"})," command will produce a newly compiled Move upgrade transaction script, its binary, and the hash."]}),"\n",(0,r.jsx)(t.p,{children:"You need to provide:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.code,{children:"--output-dir"}),": this directory the upgrade transaction files should be saved to. A new folder called ",(0,r.jsx)(t.code,{children:"framework_upgrade"})," will be created under the output-dir path."]}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.code,{children:"--framework-local-dir"}),": the source code for the framework so that the transaction script can import it as a dependency."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"\n# Note the paths\nlibra-framework  upgrade --output-dir <OUTPUT_DIR> --framework-local-dir <FRAMEWORK_PATH>\n\n# Example\nlibra-framework  upgrade --output-dir ~/framework_upgrade --framework-local-dir ~/libra-framework/framework/\n"})}),"\n",(0,r.jsxs)(t.admonition,{type:"note",children:[(0,r.jsx)(t.p,{children:"This creates 3 seperate library upgrade script directories"}),(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"1-move-stdlib"}),"\n",(0,r.jsx)(t.li,{children:"2-vendor-stdlib"}),"\n",(0,r.jsx)(t.li,{children:"3-libra-framework"}),"\n"]}),(0,r.jsx)(t.p,{children:"You will choose depending on which library you want updated"})]}),"\n",(0,r.jsx)(t.p,{children:"All the artifacts are now created, the proposal transaction can be submitted. But it's a good idea to document this on github first."}),"\n",(0,r.jsx)(t.h5,{id:"2-share-the-output-artifacts-on-github",children:"2. Share the output artifacts on Github."}),"\n",(0,r.jsx)(t.p,{children:"Create a new repository with the outputted directory. Add a README.md file."}),"\n",(0,r.jsx)(t.p,{children:"The proposer can add the link to this Github repo in the proposal phase."}),"\n",(0,r.jsx)(t.h3,{id:"upgrade-ceremony",children:"Upgrade Ceremony"}),"\n",(0,r.jsxs)(t.h5,{id:"3-with-txs-anyone-no-authority-needed-can-submit-the-proposal-and-metadata-youll-need-to-provide-the-actual-script-compiled-path-and-an-optional-url-which-contains-documentation-of-the-proposal-eg-github",children:["3. With ",(0,r.jsx)(t.code,{children:"txs"})," anyone (no authority needed) can submit the proposal and metadata. You'll need to provide the actual script compiled path, and an optional URL which contains documentation of the proposal (e.g github)."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"# note the actual script dir\nlibra txs upgrade propose --proposal-script-dir <PROPOSAL_SCRIPT_DIR> --metadata-url <URL>\n\n# Example\nlibra txs upgrade propose --proposal-script-dir ~/framework_upgrade/3-libra-framework/ --metadata-url https://www.github.com/0LNetworkCommunity/UpdateProposalTemplate\n\n"})}),"\n",(0,r.jsx)(t.p,{children:"If this transaction succeeds it will produce a proposal id, which is a number. Now the proposal is open to voting."}),"\n",(0,r.jsx)(t.admonition,{type:"note",children:(0,r.jsxs)(t.p,{children:["You can query the next proposal using this command: ",(0,r.jsx)(t.code,{children:" libra query view --function-id 0x1::diem_governance::get_next_governance_proposal_id"})]})}),"\n",(0,r.jsxs)(t.h5,{id:"4-with-libra-txs-anyone-with-governance-authority-the-epochs-validators-as-of-v7-can-submit-a-vote-in-favor-or-against-it-with---should-fail",children:["4. With ",(0,r.jsx)(t.code,{children:"libra txs"})," anyone with governance authority (the epoch's validators as of ",(0,r.jsx)(t.code,{children:"V7"}),"), can submit a vote in favor (or against it with ",(0,r.jsx)(t.code,{children:"--should-fail"}),")."]}),"\n",(0,r.jsx)(t.p,{children:'We assume the default is to vote in favor. To vote "approve" simply:'}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"txs vote --proposal-id <PROPOSAL_ID>\n"})}),"\n",(0,r.jsx)(t.p,{children:"If voter would like the proposal to be rejected:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"txs vote --proposal-id <PROPOSAL_ID> --should-fail\n"})}),"\n",(0,r.jsx)(t.admonition,{type:"note",children:(0,r.jsxs)(t.p,{children:["You can query to see the for and against votes using this command: ",(0,r.jsx)(t.code,{children:" libra query view --function-id 0x1::diem_governance::get_votes --args <proposal_number>"})]})}),"\n",(0,r.jsxs)(t.p,{children:["After everyone has voted (to reach the consensus threshold of 66% as of  ",(0,r.jsx)(t.code,{children:"V7"}),'), the proposal will be in a "Resolvable" state. Anyone can resolve it by submitting the upgrade transaction. This means the sender must have the source transaction script for the upgrade (step #1 above).']}),"\n",(0,r.jsxs)(t.h5,{id:"6-use-txs-to-resolve-a-successfully-approved-proposal",children:["6. Use ",(0,r.jsx)(t.code,{children:"txs"})," to resolve a successfully approved proposal"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"# Note the actual path\nlibra txs upgrade resolve --proposal-script-dir <PROPOSAL_SCRIPT_DIR> --proposal-id <PROPOSAL_ID>\n\n# Example \nlibra txs upgrade resolve --proposal-script-dir ~/framework_upgrade/3-libra-framework/ --proposal-id 0\n"})}),"\n",(0,r.jsx)(t.p,{children:"If this transaction is successful the new bytecode will be written to the VM, and a new epoch will be triggered."})]})}function h(e={}){const{wrapper:t}={...(0,a.a)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},1151:(e,t,o)=>{o.d(t,{Z:()=>s,a:()=>n});var r=o(7294);const a={},i=r.createContext(a);function n(e){const t=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:n(e.components),r.createElement(i.Provider,{value:t},e.children)}}}]);