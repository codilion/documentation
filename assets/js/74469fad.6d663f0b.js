"use strict";(self.webpackChunk_0_l_documentation=self.webpackChunk_0_l_documentation||[]).push([[6597],{8220:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>h,frontMatter:()=>i,metadata:()=>r,toc:()=>d});var a=t(5893),o=t(1151);const i={sidebar_position:4,sidebar_label:"Restore",description:"Restore and sync the 0L Network database to the current state"},s="Restore",r={id:"validators/restore",title:"Restore",description:"Restore and sync the 0L Network database to the current state",source:"@site/docs/validators/restore.md",sourceDirName:"validators",slug:"/validators/restore",permalink:"/validators/restore",draft:!1,unlisted:!1,editUrl:"https://github.com/0LNetworkCommunity/documentation/edit/main/docs/validators/restore.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4,sidebar_label:"Restore",description:"Restore and sync the 0L Network database to the current state"},sidebar:"tutorialSidebar",previous:{title:"Running a Validator",permalink:"/validators/detailed-instructions"},next:{title:"Genesis Ceremony",permalink:"/validators/genesis"}},l={},d=[{value:"Prerequisites",id:"prerequisites",level:3},{value:"Initialize configs",id:"initialize-configs",level:3},{value:"Update upstream node",id:"update-upstream-node",level:3},{value:"Clone and build the epoch-archive-mainnet repository",id:"clone-and-build-the-epoch-archive-mainnet-repository",level:3},{value:"Sync as a Fullnode",id:"sync-as-a-fullnode",level:3},{value:"Get the latest state of the chain",id:"get-the-latest-state-of-the-chain",level:4},{value:"Start as a fullnode (or vfn or validator node depending on your need)",id:"start-as-a-fullnode-or-vfn-or-validator-node-depending-on-your-need",level:4},{value:"Verify",id:"verify",level:4},{value:"How to clean the database and sync to the latest state again?",id:"how-to-clean-the-database-and-sync-to-the-latest-state-again",level:3}];function c(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h3:"h3",h4:"h4",p:"p",pre:"pre",strong:"strong",...(0,o.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h1,{id:"restore",children:"Restore"}),"\n",(0,a.jsxs)(n.p,{children:["Restore the 0L Network database to get up-to-date with the current state of the network. The ",(0,a.jsx)(n.code,{children:"epoch-archive-mainnet"})," ",(0,a.jsx)(n.a,{href:"https://github.com/0LNetworkCommunity/epoch-archive-mainnet",children:"repository"})," contains other useful commands that are out of the scope of this tutorial but are easily accessible in the readme file of the repository and its ",(0,a.jsx)(n.code,{children:"Makefile"}),"."]}),"\n",(0,a.jsx)(n.h3,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,a.jsxs)(n.admonition,{type:"note",children:[(0,a.jsxs)(n.p,{children:["You will need an account and libra configuration to use this tool. If you don't have an account yet, you can use the following command to create one. ",(0,a.jsx)(n.em,{children:(0,a.jsx)(n.strong,{children:"Make sure to store your mnemonics!"})})]}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"libra wallet keygen\n"})})]}),"\n",(0,a.jsx)(n.h3,{id:"initialize-configs",children:"Initialize configs"}),"\n",(0,a.jsxs)(n.p,{children:["Currently, you need to sync as a full node. To do that you need to initialize ",(0,a.jsx)(n.code,{children:"fullnode.yaml"})," in ",(0,a.jsx)(n.code,{children:"~/.libra/fullnode.yaml"}),". Use the following command to generate the ",(0,a.jsx)(n.code,{children:"fullnode.yaml"})," file:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"libra config fullnode-init\n"})}),"\n",(0,a.jsx)(n.h3,{id:"update-upstream-node",children:"Update upstream node"}),"\n",(0,a.jsxs)(n.p,{children:["Set your client ",(0,a.jsx)(n.code,{children:"libra.yaml"})," with the rpc-load-balancer upstream node"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"libra config fix --force-url https://rpc.openlibra.space:8080\n"})}),"\n",(0,a.jsx)(n.h3,{id:"clone-and-build-the-epoch-archive-mainnet-repository",children:"Clone and build the epoch-archive-mainnet repository"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"cd ~\ngit clone https://github.com/0LNetworkCommunity/epoch-archive-mainnet\ncd ~/epoch-archive-mainnet\nmake bins\n"})}),"\n",(0,a.jsx)(n.h3,{id:"sync-as-a-fullnode",children:"Sync as a Fullnode"}),"\n",(0,a.jsx)(n.admonition,{type:"warning",children:(0,a.jsxs)(n.p,{children:["You will need to open port ",(0,a.jsx)(n.code,{children:"6182"})]})}),"\n",(0,a.jsx)(n.h4,{id:"get-the-latest-state-of-the-chain",children:"Get the latest state of the chain"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"make restore-all\n"})}),"\n",(0,a.jsx)(n.h4,{id:"start-as-a-fullnode-or-vfn-or-validator-node-depending-on-your-need",children:"Start as a fullnode (or vfn or validator node depending on your need)"}),"\n",(0,a.jsxs)(n.p,{children:["The following example starts the node as a fullnode by providing the ",(0,a.jsx)(n.code,{children:"fullnode.yaml"})," as its config option:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"libra node --config-path ~/.libra/fullnode.yaml\n"})}),"\n",(0,a.jsx)(n.h4,{id:"verify",children:"Verify"}),"\n",(0,a.jsxs)(n.p,{children:["You can check that you are syncing by checking that your ",(0,a.jsx)(n.code,{children:"ledger_version"})," and ",(0,a.jsx)(n.code,{children:"block_height"})," are increasing via the API endpoint"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"watch 'curl localhost:8080/v1/ | jq'\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Response example:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "chain_id": 2,\n  "epoch": "700",\n  "ledger_version": "3322278",\n  "oldest_ledger_version": "3316234",\n  "ledger_timestamp": "1699327458805056",\n  "node_role": "full_node",\n  "oldest_block_height": "1581950",\n  "block_height": "1584970",\n  "git_hash": "bafac94d6edd39d972729db21156d47758eb8969"\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"how-to-clean-the-database-and-sync-to-the-latest-state-again",children:"How to clean the database and sync to the latest state again?"}),"\n",(0,a.jsxs)(n.p,{children:["The following instructions will remove your existing ",(0,a.jsx)(n.code,{children:"~/.libra/data/db/"})," directory and also update the ",(0,a.jsx)(n.code,{children:"epoch-archive.yaml"})," file with the latest waypoint. You can study the ",(0,a.jsx)(n.code,{children:"Makefile"})," in the ",(0,a.jsx)(n.code,{children:"epoch-archive-mainnet"})," ",(0,a.jsx)(n.a,{href:"https://github.com/0LNetworkCommunity/epoch-archive-mainnet",children:"repository"})," to fine-tune and understand its instructions better."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"cd ~/epoch-archive-mainnet\nmake wipe-db && make restore-all\n"})})]})}function h(e={}){const{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},1151:(e,n,t)=>{t.d(n,{Z:()=>r,a:()=>s});var a=t(7294);const o={},i=a.createContext(o);function s(e){const n=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),a.createElement(i.Provider,{value:n},e.children)}}}]);